{% extends "base.html" %}
{% block title %}Modifica Socio | SuperGym{% endblock %}

{% load widget_tweaks %}

{% block content %}
<div class="container mt-5">

    <!-- Titolo e link indietro -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3">Modifica Socio</h1>
        <a href="{% url 'dashboard' %}" class="btn btn-outline-secondary">‚¨Ö Torna alla Dashboard</a>
    </div>

    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}

        <!-- Tabs -->
        <ul class="nav nav-tabs mb-4" id="editMemberTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="dati-tab" data-bs-toggle="tab" data-bs-target="#dati" type="button" role="tab" aria-controls="dati" aria-selected="true">Dati Socio</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="documenti-tab" data-bs-toggle="tab" data-bs-target="#documenti" type="button" role="tab" aria-controls="documenti" aria-selected="false">Documenti</button>
            </li>
        </ul>

        <div class="tab-content" id="editMemberTabsContent">
            <!-- Tab Dati Socio -->
            <div class="tab-pane fade show active" id="dati" role="tabpanel" aria-labelledby="dati-tab">
                <div class="card shadow mb-4 p-4">
                    <div class="row g-3">
                        {% for field in form %}
                            <div class="col-md-6">
                                <label class="form-label">{{ field.label }}</label>
                                {{ field|add_class:"form-control" }}
                                {% if field.help_text %}
                                    <small class="form-text text-muted">{{ field.help_text }}</small>
                                {% endif %}
                                {% for error in field.errors %}
                                    <div class="text-danger small">{{ error }}</div>
                                {% endfor %}
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Tab Documenti -->
            <div class="tab-pane fade" id="documenti" role="tabpanel" aria-labelledby="documenti-tab">
                <div class="card shadow mb-4 p-4">
                    <h5 class="mb-3">Documenti del Socio</h5>

                    {{ formset.management_form }}
                    {% for doc_form in formset %}
                        <div class="card p-3 mb-3 shadow-sm">
                            <div class="row g-2">
                                {% for field in doc_form %}
                                    <div class="col-md-4">
                                        <label class="form-label">{{ field.label }}</label>
                                        {{ field|add_class:"form-control" }}
                                        {% for error in field.errors %}
                                            <div class="text-danger small">{{ error }}</div>
                                        {% endfor %}
                                    </div>
                                {% endfor %}
                                {% if formset.can_delete %}
                                    <div class="col-md-2 d-flex align-items-end">
                                        <div class="form-check">
                                            {{ doc_form.DELETE|add_class:"form-check-input" }}
                                            <label class="form-check-label">Elimina</label>
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}

                    <div class="mt-2">
                        <a href="{% url 'members:add_member_document' member.id %}" class="btn btn-primary">
                            ‚ûï Aggiungi Documento
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottoni principali -->
        <div class="mt-3 d-flex gap-2">
            <button type="submit" class="btn btn-success">üíæ Salva Modifiche</button>
            <a href="{% url 'dashboard' %}" class="btn btn-secondary">‚ùå Annulla</a>
        </div>
    </form>
</div>

{% endblock %}
